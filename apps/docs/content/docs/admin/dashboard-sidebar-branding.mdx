---
title: Dashboard, Sidebar & Branding
description: Configure navigation, dashboard widgets, and admin branding
---

# Dashboard, Sidebar & Branding

The dashboard, sidebar, and branding are configured on the server builder (`q`) via `@questpie/admin/server`. The client (`qa`) only resolves registries and renders the server contract.

## Sidebar

The sidebar is defined on the server with `.sidebar()`:

```ts
const app = q({ name: "barbershop" })
  .use(adminModule)
  .collections({ barbers, services, appointments, reviews, pages })
  .globals({ siteSettings })
  .sidebar(({ s }) =>
    s.sidebar({
      sections: [
        {
          label: "Content",
          items: [
            s.collection("barbers"),
            s.collection("services"),
            s.collection("pages"),
          ],
        },
        {
          label: "Business",
          items: [
            s.collection("appointments"),
            s.collection("reviews"),
          ],
        },
        {
          label: "Settings",
          items: [
            s.global("siteSettings"),
          ],
        },
      ],
    }),
  );
```

### Sidebar Item Types

| Type | Factory | Description |
|---|---|---|
| Collection | `s.collection("name")` | Links to collection list view |
| Global | `s.global("name")` | Links to global form view |
| Page | `s.page("name")` | Links to a custom admin page |
| Link | `s.link({ url, label })` | External or internal link |
| Divider | `s.divider()` | Visual separator |

### Sidebar Section Config

```ts
{
  label: string;                   // Section heading
  icon?: ComponentReference;       // Section icon
  items: SidebarItem[];           // Items in this section
  collapsible?: boolean;           // Allow user to collapse/expand (persisted)
}
```

## Dashboard

The dashboard is defined on the server with `.dashboard()`:

```ts
.dashboard(({ d, c, a }) =>
  d.dashboard({
    columns: 4,
    actions: [
      a.create({
        id: "new-appointment",
        collection: "appointments",
        label: "New Appointment",
        icon: c.icon("ph:calendar-plus"),
        variant: "primary",
      }),
      a.global({
        id: "site-settings",
        global: "siteSettings",
        label: "Site Settings",
        icon: c.icon("ph:gear-six"),
      }),
      a.link({
        id: "open-site",
        label: "Open Website",
        href: "/",
        icon: c.icon("ph:arrow-square-out"),
        variant: "outline",
      }),
    ],
    items: [
      d.stats({
        collection: "appointments",
        label: "Today's Appointments",
        datePreset: "today",
        span: 1,
      }),
      d.stats({
        collection: "barbers",
        label: "Active Barbers",
        span: 1,
      }),
      d.recentItems({
        collection: "reviews",
        label: "Latest Reviews",
        limit: 5,
        span: 2,
      }),
      d.section({
        label: "Activity",
        wrapper: "card",
        items: [
          d.timeline({
            collection: "appointments",
            label: "Recent Activity",
          }),
        ],
      }),
    ],
  }),
)
```

### Dashboard Configuration

| Option | Type | Default | Description |
|---|---|---|---|
| `layout` | `"grid" \| "list"` | `"grid"` | Layout mode |
| `columns` | `number` | `4` | Grid columns |
| `gap` | `number` | — | Gap between widgets |
| `showRefresh` | `boolean` | — | Show refresh button |
| `refreshInterval` | `number` | — | Auto-refresh (ms) |
| `realtime` | `boolean` | — | Enable realtime updates |
| `actions` | `DashboardAction[]` | — | Header action buttons |

### Header Action Helpers (`a`)

Use `a` helpers in `.dashboard(({ d, c, a }) => ...)` for typed, consistent admin routes.

| Helper | Input | Resolves to |
|---|---|---|
| `a.create(...)` | `{ collection: "appointments" }` | `/admin/collections/appointments/create` |
| `a.global(...)` | `{ global: "siteSettings" }` | `/admin/globals/siteSettings` |
| `a.link(...)` | `{ href: "/custom" }` | `/custom` |
| `a.action(...)` | `{ href: "/custom" }` | `/custom` |

### Widget Types

| Widget | Factory | Description |
|---|---|---|
| Stats | `d.stats({})` | Count with change percentage |
| Chart | `d.chart({})` | Chart visualization |
| Recent Items | `d.recentItems({})` | List of latest records |
| Quick Actions | `d.quickActions({})` | Action buttons |
| Value | `d.value({})` | Single value with trend |
| Table | `d.table({})` | Mini table |
| Timeline | `d.timeline({})` | Activity timeline |
| Progress | `d.progress({})` | Progress bar toward goal |

### Widget Common Config

Every widget accepts:

```ts
{
  label?: string;                  // Widget title
  description?: string;            // Widget subtitle
  icon?: ComponentReference;       // Widget icon
  span?: number;                   // Column span (1-12)
  size?: "small" | "medium" | "large" | "full";
  cardVariant?: "default" | "compact" | "featured";
  refreshInterval?: number;        // Widget-specific refresh (ms)
  realtime?: boolean;              // Enable realtime invalidation
}
```

### Dashboard Sections and Tabs

Group widgets into sections or tabs:

```ts
// Section
d.section({
  label: "Analytics",
  wrapper: "card",          // "flat" | "card" | "collapsible"
  layout: "grid",
  columns: 2,
  items: [d.stats({...}), d.chart({...})],
})

// Tabs
d.tabs({
  defaultTab: "overview",
  variant: "line",          // "default" | "line" | "pills"
  tabs: [
    { id: "overview", label: "Overview", items: [...] },
    { id: "activity", label: "Activity", items: [...] },
  ],
})
```

## Branding

Branding is configured on the server via `.branding()`:

```ts
const app = q({ name: "barbershop" })
  .use(adminModule)
  .branding({
    name: { en: "Barbershop Admin", sk: "Barbershop Admin" },
    logo: "/logo.svg",
  });
```

### Branding Options

| Option | Type | Description |
|---|---|---|
| `name` | `string \| Record<string, string>` | Brand name shown in sidebar header |
| `logo` | `unknown` | Logo value rendered by the admin shell |

## Locale Configuration

```ts
q({ name: "barbershop" })
  .use(adminModule)
  .adminLocale({
    locales: ["en", "sk"],
    defaultLocale: "en",
  })
  .locale({
    locales: [{ code: "en" }, { code: "sk" }],
    defaultLocale: "en",
  })
  .messages({
    en: { "common.save": "Save" },
    sk: { "common.save": "Ulozit" },
  });
```

- `.adminLocale()` controls admin UI language options.
- `.locale()` controls content locale options for localized fields.
- `.messages()` provides translation messages.

Use `useServerTranslations` in `AdminLayoutProvider` so the client fetches locales/messages from the server.

```tsx
<AdminLayoutProvider
  admin={admin}
  client={client}
  useServerTranslations
>
  {children}
</AdminLayoutProvider>
```

## Server-side Widget Loaders

Widgets that need server-side data (DB queries, computed metrics) use a `loader` function. The loader runs on the server and its result is sent to the client via the `fetchWidgetData` RPC endpoint.

```ts
.dashboard(({ d }) =>
  d.dashboard({
    items: [
      d.value({
        id: "monthly-revenue",
        label: "Revenue",
        loader: async ({ app, db }) => {
          const result = await app.api.collections.orders.find({
            limit: 0,
            accessMode: "system",
            db,
          });
          return { value: result.totalDocs, label: "Total Orders" };
        },
      }),
      d.timeline({
        id: "recent-activity",
        label: "Recent Activity",
        loader: async ({ app, db }) => {
          // query and return TimelineItem[]
        },
      }),
    ],
  }),
)
```

Available in the loader context: `app` (typed QuestPie instance), `db`, `session`, `locale`.

Widget types that support `loader`: `stats`, `chart`, `recentItems`, `custom`, `value`, `table`, `timeline`, `progress`.

## Audit Module

The audit module is **opt-in** — add `.use(auditModule)` to enable automatic audit logging for all collection and global mutations.

```ts
import { adminModule, auditModule, createAuditDashboardWidget } from "@questpie/admin/server";

const app = q({ name: "my-app" })
  .use(adminModule)
  .use(auditModule)  // opt-in: registers collection + global hooks + cleanup job
  .sidebar(({ s, c }) =>
    s.sidebar({
      sections: [
        s.section({
          id: "admin",
          title: "Administration",
          items: [
            { type: "collection", collection: "user" },
            { type: "collection", collection: "adminAuditLog" },
          ],
        }),
      ],
    }),
  )
  .dashboard(({ d }) =>
    d.dashboard({
      items: [
        createAuditDashboardWidget({ maxItems: 10 }),  // timeline widget
      ],
    }),
  )
  .build({ ... });
```

### Per-collection opt-out

Collections with `audit: false` in `.admin()` are automatically skipped by the audit hooks. All internal admin collections already have this set. To disable auditing for your own collection:

```ts
const tempData = q.collection("temp_data")
  .fields(...)
  .admin({ audit: false });
```

### Custom configuration

Use `createAuditModule()` for fine-grained control:

```ts
import { createAuditModule } from "@questpie/admin/server";

const audit = createAuditModule({
  retentionDays: 30,  // cleanup after 30 days (default: 90)
});
```

To customize the audit collection's access rules, merge your own access config:

```ts
import { auditLogCollection } from "@questpie/admin/server";

const app = q({ name: "my-app" })
  .use(adminModule)
  .use(auditModule)
  .collections({
    adminAuditLog: auditLogCollection.access({
      read: ({ session }) => session?.user?.role === "admin",
    }),
  })
  .build({ ... });
```

### Exports

| Export | Description |
|---|---|
| `auditModule` | Default audit module instance |
| `createAuditModule(options?)` | Factory with custom config |
| `createAuditDashboardWidget(options?)` | Dashboard timeline widget factory |
| `auditLogCollection` | Raw collection builder (for merging/overriding) |

## Common Mistakes

- **Configuring branding on `qa()`** — Branding belongs on server `q().branding()`.
- **Configuring admin UI locale on `qa()`** — Use `q().adminLocale()` and `useServerTranslations`.
- **Widget `span` exceeding columns** — If `span: 3` but `columns: 2`, the widget overflows. Keep `span` at most equal to `columns`.
- **Missing collection in sidebar** — If a collection exists but isn't in the sidebar, it's still accessible via URL but not discoverable. Always include active collections in the sidebar.

## Related Pages

- [Admin Overview](/docs/admin) — Architecture overview
- [Client Builder (qa)](/docs/admin/client-builder-qa) — Registry ownership
- [Component Registry](/docs/admin/component-registry) — How icon references work
- [Localization](/docs/server/localization) — Content vs admin locale split
