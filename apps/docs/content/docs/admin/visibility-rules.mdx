---
title: Visibility Rules
description: When collections and globals appear in the admin panel
---

# Visibility Rules

This guide explains when collections and globals are visible in the admin panel, covering access control, the `hidden` flag, and sidebar behavior.

## Two-Layer Visibility

QUESTPIE uses two layers to determine admin visibility:

```
┌─────────────────────────────────────────────────────────┐
│            LAYER 1: ACCESS CONTROL                       │
│     Server-side security based on access.read rules      │
│     If denied → collection not in API response at all    │
├─────────────────────────────────────────────────────────┤
│            LAYER 2: ADMIN VISIBILITY                     │
│     UI visibility based on .admin({ hidden: true })      │
│     If hidden → not in sidebar, search, or direct URL    │
└─────────────────────────────────────────────────────────┘
```

### Layer 1: Access Control (Security)

Server-side filtering based on `access.read` rules. If a user doesn't have read access, the collection/global is completely hidden from the API response.

```ts
const privateCollection = q.collection("internal-logs")
  .fields(f => ({ ... }))
  .access({
    read: false, // No one can see this in admin
  });

const adminOnlyCollection = q.collection("settings")
  .fields(f => ({ ... }))
  .access({
    read: ({ session }) => session?.user?.role === "admin",
  });
```

### Layer 2: Admin Visibility (UI)

Client-side filtering based on `.admin({ hidden: true })`. Hidden items are still accessible via API but don't appear in navigation, search, or direct URL access.

```ts
const sessions = q.collection("sessions")
  .fields(f => ({ ... }))
  .admin({ hidden: true }); // Not shown in admin UI
```

## The `hidden` Flag

Use `.admin({ hidden: true })` to hide collections from the admin interface:

```ts
const sessions = q.collection("sessions")
  .fields(f => ({
    userId: f.text(),
    token: f.text(),
    expiresAt: f.date(),
  }))
  .admin({ hidden: true });
```

### What `hidden` Affects

| Feature | Hidden Collection |
|---------|-------------------|
| Sidebar navigation | Not shown |
| Global search | Not searchable |
| Direct URL access | Shows "Access Restricted" page |
| Dashboard widgets | Can reference (if configured) |
| Relation fields | Can select items from hidden collections |
| API access | Full access (hidden is UI-only) |

### Common Use Cases

**Internal system collections:**
```ts
// Auth-related collections managed by the system
const sessions = q.collection("sessions").admin({ hidden: true });
const accounts = q.collection("accounts").admin({ hidden: true });
const apiKeys = q.collection("apikeys").admin({ hidden: true });
```

**Draft/staging collections:**
```ts
// Collection not ready for editors yet
const newFeature = q.collection("beta-feature")
  .fields(f => ({ ... }))
  .admin({ hidden: true }); // Hide until ready
```

**Programmatically-managed collections:**
```ts
// Data synced from external system
const syncedProducts = q.collection("synced-products")
  .fields(f => ({ ... }))
  .admin({ hidden: true }); // Managed via API only
```

## Access Control Examples

### Public Collection (Everyone Can Read)

```ts
const posts = q.collection("posts")
  .fields(f => ({
    title: f.text(),
    content: f.richText(),
  }))
  .access({
    read: true, // All authenticated users can see in admin
  });
```

### Role-Based Access

```ts
const settings = q.collection("settings")
  .fields(f => ({
    key: f.text(),
    value: f.json(),
  }))
  .access({
    read: ({ session }) => session?.user?.role === "admin",
    update: ({ session }) => session?.user?.role === "admin",
  });
```

### Row-Level Filtering

When `access.read` returns a filter object, the collection is visible but only matching rows are shown:

```ts
const documents = q.collection("documents")
  .fields(f => ({
    title: f.text(),
    ownerId: f.text(),
  }))
  .access({
    read: ({ session }) => ({
      // User sees collection in admin, but only their documents
      ownerId: session?.user?.id,
    }),
  });
```

## Sidebar Behavior

### Auto-Generated Sidebar

When no `.sidebar()` is configured, collections appear automatically:

```ts
const cms = q({ name: "app" })
  .use(adminModule)
  .collections({
    posts,      // Visible (not hidden)
    pages,      // Visible (not hidden)
    sessions,   // Hidden via .admin({ hidden: true })
  });
// Sidebar auto-generated with: posts, pages
// sessions is excluded because hidden: true
```

Collections are:
- Grouped by `.admin({ group: "Content" })`
- Ordered by `.admin({ order: 1 })`
- Hidden items are always excluded

### Explicit Sidebar

With `.sidebar()`, you control exactly what appears:

```ts
const cms = q({ name: "app" })
  .use(adminModule)
  .collections({ posts, pages, comments, sessions })
  .sidebar(({ s }) =>
    s.sidebar({
      sections: [
        {
          label: "Content",
          items: [s.collection("posts"), s.collection("pages")],
        },
      ],
    }),
  );
// Sidebar shows: posts, pages
// comments auto-appended (not listed, not hidden)
// sessions excluded (hidden: true)
```

Key behaviors:
- Only listed items appear in their specified positions
- Unlisted accessible, non-hidden items are auto-appended at the end
- Hidden items are never auto-appended, even if not listed

## Visibility Matrix

| Condition | Sidebar | Search | Direct URL | API |
|-----------|---------|--------|------------|-----|
| `access.read: false` | No | No | No | No |
| `access.read: true` | Yes | Yes | Yes | Yes |
| `access.read: { filter }` | Yes | Yes | Yes | Filtered |
| `hidden: true` | No | No | No* | Yes |
| `hidden: true` + explicit sidebar | No | No | No* | Yes |

*Shows "Access Restricted" page instead of 404.

## Internal Collections Pattern

QUESTPIE's `adminModule` automatically hides auth-related collections:

```ts
// Inside @questpie/admin/server
export const adminModule = {
  collections: {
    session: starterModule.state.collections.session.admin({ hidden: true }),
    account: starterModule.state.collections.account.admin({ hidden: true }),
    verification: starterModule.state.collections.verification.admin({ hidden: true }),
    apikey: starterModule.state.collections.apikey.admin({ hidden: true }),
    adminSavedViews: savedViewsCollection.admin({ hidden: true }),
    adminPreferences: adminPreferencesCollection.admin({ hidden: true }),
    adminLocks: locksCollection.admin({ hidden: true }),
  },
};
```

This keeps auth/system collections accessible via API but out of the admin UI, reducing clutter for content editors.

## Combining Access and Hidden

You can combine both layers for fine-grained control:

```ts
const auditLogs = q.collection("audit-logs")
  .fields(f => ({
    action: f.text(),
    userId: f.text(),
    timestamp: f.date(),
  }))
  .access({
    // Only admins can access via API
    read: ({ session }) => session?.user?.role === "admin",
    create: false, // System-only writes
    update: false,
    delete: false,
  })
  .admin({
    // Even admins don't see it in sidebar (access via direct URL only)
    hidden: true,
  });
```

This creates a collection that:
- Is only accessible to admins
- Doesn't appear in sidebar or search
- Shows "Access Restricted" for non-admins trying direct URL
- Can be accessed by admins who know the URL... wait, no - if hidden is true, even admins get "Access Restricted"

Actually, `hidden: true` blocks everyone from the UI, regardless of access. If you want admins to access via direct URL but not see in sidebar:

```ts
// Currently not supported - hidden is all-or-nothing for UI
// Use explicit sidebar to control what appears:
.sidebar(({ s }) =>
  s.sidebar({
    sections: [
      { label: "Content", items: [s.collection("posts")] },
      // Don't list audit-logs - it won't appear in sidebar
      // but can still be accessed via direct URL
    ],
  }),
)
```

## Best Practices

1. **Use `hidden: true` for system collections** that users should never interact with directly (sessions, tokens, locks).

2. **Use access rules for security**, not visibility. Never rely on `hidden` to protect sensitive data.

3. **Use explicit sidebar** when you need fine-grained control over what appears where.

4. **Group related collections** with `.admin({ group: "Category" })` for better organization in auto-generated sidebars.

5. **Set order** with `.admin({ order: 1 })` to control sort order within groups.
