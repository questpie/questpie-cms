---
title: Server
description: Core schema layer — collections, globals, fields, hooks, access, and RPC
---

# Server

The server layer is the heart of QUESTPIE. It defines **WHAT** your runtime does: schema, behavior, access rules, and integration surface. Admin UI is optional and attaches to this same contract.

## Mental Model

```text
QuestpieBuilder (q)
  ├── .collections({ ... })     → database tables + CRUD API
  ├── .globals({ ... })         → singleton records
  ├── .auth()                   → authentication
  ├── .locale()                 → i18n configuration
  ├── .jobs()                   → background processing
  ├── .messages()               → typed translations
  └── .build(runtimeConfig)     → Questpie instance

Optional via @questpie/admin/server
  ├── .sidebar() .dashboard()   → admin navigation and dashboard blueprint
  └── collection .admin/.list/.form methods

CollectionBuilder
  ├── .fields((f) => ...)       → field definitions → DB columns
  ├── .title()                  → display title strategy
  ├── .hooks()                  → lifecycle callbacks
  ├── .access()                 → operation-level security
	├── .indexes()                → database constraints
	├── .options()                → timestamps, softDelete, versioning
	├── .searchable()             → full-text search config
	├── .validation()             → custom Zod refinements
	└── .admin/.list/.form        → optional admin metadata (with module)
```

## Core + Extension Model

`questpie` provides the runtime baseline. Capabilities are layered via modules.

Runtime-only:

```ts
import { q } from "questpie";

const cms = q({ name: "app" })
  .collections({ ... })
  .build({ db: { url: process.env.DATABASE_URL } });
```

Runtime + optional admin:

```ts
import { q } from "questpie";
import { adminModule } from "@questpie/admin/server";

const cms = q({ name: "app" })
  .use(adminModule)       // adds .admin(), .list(), .form(), .sidebar(), etc.
  .collections({ ... })
  .build({ db: { url: process.env.DATABASE_URL } });
```

## Core Concepts

**Collections** are your main entities. Each collection definition produces a database table and CRUD API endpoints from a single source of truth.

**Globals** are singletons. They work like collections but have exactly one record (site settings, feature flags, etc.).

**Fields** are semantic type definitions. `f.text()`, `f.number()`, `f.relation()` — each field knows its database column type, validation schema, and query operators.

**Hooks** are lifecycle callbacks. They run before/after CRUD operations and can modify data, enforce rules, or trigger side effects.

**Access control** determines who can read, create, update, and delete records — both at the operation level and the field level.

**RPC** lets you define typed remote procedures alongside your collections, with Zod input validation and full access to the runtime instance.

**Admin blueprint methods** (`.admin()`, `.list()`, `.form()`, `.sidebar()`, `.dashboard()`) are optional extensions provided by `@questpie/admin/server`.

## Pages in This Section

- [Collections](/docs/server/collections) — CollectionBuilder API with all methods
- [Globals](/docs/server/globals) — GlobalBuilder for singleton records
- [Field Builder](/docs/server/field-builder) — The `.fields((f) => ...)` lifecycle
- [Field Types](/docs/server/field-types) — Complete catalog of built-in field types
- [Relations](/docs/server/relations) — belongsTo, hasMany, manyToMany, polymorphic
- [Reactive Fields](/docs/server/reactive-fields) — hidden, readOnly, disabled, compute, dynamic options
- [Hooks & Lifecycle](/docs/server/hooks-and-lifecycle) — before/after callbacks for CRUD
- [Access Control](/docs/server/access-control) — Operation-level and field-level security
- [Validation](/docs/server/validation) — Zod schemas, custom refinements
- [Versioning](/docs/server/versioning) — Record history and rollback
- [Localization](/docs/server/localization) — i18n for fields and messages
- [Modules & Extensions](/docs/server/modules-and-extensions) — `.use()` composition pattern
- [RPC](/docs/server/rpc) — Typed remote procedures
- [Context & Transactions](/docs/server/context-and-transactions) — Request context and database transactions
- [Type-Safe Contexts](/docs/server/type-safe-contexts) — End-to-end typing for hooks, access, RPC, jobs, and admin handlers

## Canonical References

- `examples/tanstack-barbershop/src/questpie/server/builder.ts`
- `examples/tanstack-barbershop/src/questpie/server/cms.ts`
- `examples/tanstack-barbershop/src/questpie/server/collections/`
- `examples/tanstack-barbershop/src/questpie/server/globals/`
