---
title: Email Adapter
description: Email sending configuration
---

# Email Adapter

The email adapter handles sending emails from your CMS.

## Configuration

### SMTP Adapter (Production)

```typescript
import { SmtpAdapter } from "questpie/email";

const cms = q({ name: "my-cms" })
  .build({
    email: {
      adapter: new SmtpAdapter({
        transport: {
          host: "smtp.sendgrid.net",
          port: 465,
          secure: true,
          auth: {
            user: "apikey",
            pass: process.env.SENDGRID_API_KEY,
          },
        },
      }),
      defaults: {
        from: "My App <noreply@myapp.com>",
      },
    },
  });
```

### Console Adapter (Development)

Logs emails to console instead of sending:

```typescript
import { ConsoleAdapter } from "questpie/email";

const cms = q({ name: "my-cms" })
  .build({
    email: {
      adapter: new ConsoleAdapter({
        logHtml: false, // Don't log HTML content
        logAttachments: false,
      }),
    },
  });
```

### Resend Adapter

```typescript
import { ResendAdapter } from "questpie/email";

const cms = q({ name: "my-cms" })
  .build({
    email: {
      adapter: new ResendAdapter({
        apiKey: process.env.RESEND_API_KEY,
      }),
      defaults: {
        from: "My App <noreply@myapp.com>",
      },
    },
  });
```

## Sending Emails

### Basic Email

```typescript
await cms.email.send({
  to: "user@example.com",
  subject: "Welcome to My App",
  html: "<h1>Hello!</h1><p>Welcome to our platform.</p>",
});
```

### With Text Alternative

```typescript
await cms.email.send({
  to: "user@example.com",
  subject: "Welcome",
  html: "<h1>Hello!</h1>",
  text: "Hello! Welcome to our platform.",
});
```

### Multiple Recipients

```typescript
await cms.email.send({
  to: ["user1@example.com", "user2@example.com"],
  cc: ["manager@example.com"],
  bcc: ["audit@example.com"],
  subject: "Team Update",
  html: "<p>Important update...</p>",
});
```

### With Attachments

```typescript
await cms.email.send({
  to: "user@example.com",
  subject: "Your Report",
  html: "<p>Please find the report attached.</p>",
  attachments: [
    {
      filename: "report.pdf",
      content: pdfBuffer,
      contentType: "application/pdf",
    },
    {
      filename: "data.csv",
      path: "/path/to/data.csv", // From filesystem
    },
    {
      filename: "logo.png",
      path: "https://example.com/logo.png", // From URL
    },
  ],
});
```

### Reply-To and Headers

```typescript
await cms.email.send({
  to: "user@example.com",
  from: "noreply@myapp.com",
  replyTo: "support@myapp.com",
  subject: "Support Request #123",
  html: "<p>Your request has been received.</p>",
  headers: {
    "X-Request-ID": "req-123",
    "X-Priority": "1",
  },
});
```

## Email Templates

### With React Email

```typescript
import { render } from "@react-email/render";
import { WelcomeEmail } from "./emails/welcome";

await cms.email.send({
  to: user.email,
  subject: "Welcome!",
  html: render(WelcomeEmail({ name: user.name })),
});
```

### Template Function

```typescript
// emails/welcome.tsx
import {
  Html,
  Head,
  Body,
  Container,
  Heading,
  Text,
} from "@react-email/components";

interface WelcomeEmailProps {
  name: string;
  verifyUrl: string;
}

export function WelcomeEmail({ name, verifyUrl }: WelcomeEmailProps) {
  return (
    <Html>
      <Head />
      <Body style={{ fontFamily: "sans-serif" }}>
        <Container>
          <Heading>Welcome, {name}!</Heading>
          <Text>
            Thanks for signing up. Please verify your email:
          </Text>
          <a href={verifyUrl}>Verify Email</a>
        </Container>
      </Body>
    </Html>
  );
}
```

### Template Registry

```typescript
// emails/index.ts
import { WelcomeEmail } from "./welcome";
import { ResetPasswordEmail } from "./reset-password";
import { OrderConfirmationEmail } from "./order-confirmation";

export const emailTemplates = {
  welcome: WelcomeEmail,
  resetPassword: ResetPasswordEmail,
  orderConfirmation: OrderConfirmationEmail,
};

// Usage with helper
async function sendTemplateEmail<T extends keyof typeof emailTemplates>(
  template: T,
  props: Parameters<typeof emailTemplates[T]>[0],
  options: { to: string; subject: string }
) {
  const Template = emailTemplates[template];
  const html = render(Template(props));

  await cms.email.send({
    to: options.to,
    subject: options.subject,
    html,
  });
}

// Use
await sendTemplateEmail(
  "welcome",
  { name: "John", verifyUrl: "https://..." },
  { to: "john@example.com", subject: "Welcome!" }
);
```

## Email Options

```typescript
interface EmailOptions {
  // Recipients
  to: string | string[];
  cc?: string | string[];
  bcc?: string | string[];

  // Sender
  from?: string;
  replyTo?: string;

  // Content
  subject: string;
  html?: string;
  text?: string;

  // Attachments
  attachments?: Attachment[];

  // Headers
  headers?: Record<string, string>;

  // Scheduling (if supported by adapter)
  sendAt?: Date;

  // Tags/metadata (for analytics)
  tags?: string[];
  metadata?: Record<string, string>;
}

interface Attachment {
  filename: string;
  content?: Buffer | string;
  path?: string;
  contentType?: string;
  encoding?: string;
  cid?: string; // For inline images
}
```

## SMTP Providers

### SendGrid

```typescript
new SmtpAdapter({
  transport: {
    host: "smtp.sendgrid.net",
    port: 465,
    secure: true,
    auth: {
      user: "apikey",
      pass: process.env.SENDGRID_API_KEY,
    },
  },
})
```

### Mailgun

```typescript
new SmtpAdapter({
  transport: {
    host: "smtp.mailgun.org",
    port: 587,
    secure: false,
    auth: {
      user: process.env.MAILGUN_USER,
      pass: process.env.MAILGUN_PASSWORD,
    },
  },
})
```

### Amazon SES

```typescript
new SmtpAdapter({
  transport: {
    host: "email-smtp.us-east-1.amazonaws.com",
    port: 465,
    secure: true,
    auth: {
      user: process.env.AWS_SES_ACCESS_KEY,
      pass: process.env.AWS_SES_SECRET_KEY,
    },
  },
})
```

### Postmark

```typescript
new SmtpAdapter({
  transport: {
    host: "smtp.postmarkapp.com",
    port: 587,
    secure: false,
    auth: {
      user: process.env.POSTMARK_API_TOKEN,
      pass: process.env.POSTMARK_API_TOKEN,
    },
  },
})
```

## Email Adapter Interface

```typescript
abstract class MailAdapter {
  abstract send(options: EmailOptions): Promise<EmailResult>;
}

interface EmailResult {
  messageId: string;
  accepted: string[];
  rejected: string[];
}
```

## Best Practices

### 1. Use Background Jobs

```typescript
// Don't block requests with email sending
const sendWelcomeEmail = q.job({
  name: "send-welcome-email",
  schema: z.object({ userId: z.string() }),
  handler: async ({ payload, app }) => {
    const user = await getUser(payload.userId);
    await app.email.send({
      to: user.email,
      subject: "Welcome!",
      html: render(WelcomeEmail({ name: user.name })),
    });
  },
});

// In your signup handler
await cms.queue.sendWelcomeEmail.publish({ userId: user.id });
```

### 2. Validate Emails

```typescript
import { z } from "zod";

const emailSchema = z.string().email();

function sendEmail(to: string) {
  emailSchema.parse(to); // Throws if invalid
  // ...
}
```

### 3. Handle Bounces

```typescript
// With webhook support
app.post("/webhooks/email", async (req) => {
  const event = req.body;

  if (event.type === "bounce") {
    await markEmailInvalid(event.email);
  }

  if (event.type === "complaint") {
    await unsubscribeUser(event.email);
  }
});
```

## Next Steps

<Cards>
  <Card href="/docs/backend/adapters/search" title="Search" description="Full-text search" />
  <Card href="/docs/guides/email-templates" title="Email Templates" description="React Email guide" />
</Cards>
