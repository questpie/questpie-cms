---
title: Backend Adapters
description: Configure storage, queue, email, search, and more
---

# Backend Adapters

QUESTPIE CMS uses adapters for external services like file storage, background jobs, email, and search. Adapters are configured in the `.build()` call.

## Overview

| Adapter | Purpose | Default |
|---------|---------|---------|
| [Storage](/docs/backend/adapters/storage) | File uploads | Local filesystem |
| [Queue](/docs/backend/adapters/queue) | Background jobs | In-memory |
| [Email](/docs/backend/adapters/email) | Send emails | Console (dev) |
| [Search](/docs/backend/adapters/search) | Full-text search | PostgreSQL FTS |
| [Realtime](/docs/backend/adapters/realtime) | Live updates | PostgreSQL NOTIFY |
| [KV](/docs/backend/adapters/kv) | Key-value cache | In-memory |
| [Logger](/docs/backend/adapters/logger) | Logging | Pino |

## Configuration

Adapters are configured when building the CMS:

```typescript
import { q } from "questpie";

const cms = q({ name: "my-cms" })
  .collections({ ... })
  .build({
    db: {
      url: process.env.DATABASE_URL,
    },

    // Storage adapter
    storage: {
      location: "./uploads",
      // Or use S3, R2, etc.
    },

    // Queue adapter
    queue: {
      adapter: pgBossAdapter({
        connectionString: process.env.DATABASE_URL,
      }),
    },

    // Email adapter
    email: {
      adapter: new SmtpAdapter({
        transport: { ... },
      }),
      defaults: {
        from: "noreply@example.com",
      },
    },

    // Search adapter
    search: createPostgresSearchAdapter({
      trigramThreshold: 0.3,
    }),

    // Realtime adapter
    realtime: {
      adapter: new PgNotifyAdapter({
        connectionString: process.env.DATABASE_URL,
      }),
    },

    // KV adapter
    kv: {
      adapter: new IORedisKVAdapter(redisClient),
      defaultTtl: 3600,
    },
  });
```

## Environment-Based Configuration

Configure different adapters for development and production:

```typescript
const cms = q({ name: "my-cms" })
  .collections({ ... })
  .build({
    db: { url: process.env.DATABASE_URL },

    // Storage: local in dev, S3 in production
    storage: process.env.NODE_ENV === "production"
      ? {
          driver: new S3Driver({
            bucket: process.env.AWS_S3_BUCKET,
            region: process.env.AWS_REGION,
            key: process.env.AWS_ACCESS_KEY_ID,
            secret: process.env.AWS_SECRET_ACCESS_KEY,
          }),
        }
      : {
          location: "./uploads",
        },

    // Email: console in dev, SMTP in production
    email: process.env.NODE_ENV === "production"
      ? {
          adapter: new SmtpAdapter({ ... }),
          defaults: { from: "noreply@example.com" },
        }
      : {
          adapter: new ConsoleAdapter(),
        },
  });
```

## Adapter Interface

All adapters follow a consistent interface pattern:

```typescript
interface Adapter {
  // Initialize the adapter
  start?(): Promise<void>;

  // Clean up resources
  stop?(): Promise<void>;
}
```

## Using Adapters

After building, access adapters through the CMS instance:

```typescript
const cms = q({ ... }).build({ ... });

// Storage
await cms.storage.put("file.txt", buffer);
const url = await cms.storage.getUrl("file.txt");

// Queue
await cms.queue.myJob.publish({ data: "value" });

// Email
await cms.email.send({
  to: "user@example.com",
  subject: "Hello",
  html: "<h1>Welcome!</h1>",
});

// KV
await cms.kv.set("key", { value: "data" }, 3600);
const data = await cms.kv.get("key");
```

## Related

- [Storage](/docs/backend/adapters/storage) - File uploads and serving
- [Queue](/docs/backend/adapters/queue) - Background jobs
- [Email](/docs/backend/adapters/email) - Email sending
- [Search](/docs/backend/adapters/search) - Full-text search
