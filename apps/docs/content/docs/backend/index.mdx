---
title: Backend Overview
description: The q() builder and server-side CMS configuration
---

# Backend Overview

The `questpie` package provides the backend CMS engine with a type-safe builder pattern.

## Key Features

- **Builder Pattern** - Fluent API with full TypeScript inference
- **Drizzle ORM** - Type-safe database operations
- **Validation** - Zod-based schema validation
- **Relations** - One-to-one, one-to-many, many-to-many
- **Hooks** - Lifecycle hooks for business logic
- **Authentication** - Better Auth integration
- **Jobs** - Background job processing
- **Search** - Full-text and faceted search
- **i18n** - Content localization

## Quick Example

```typescript
import { q, text, integer, boolean, datetime } from "questpie";
import { adminModule } from "@questpie/admin/server";

export const cms = q({ name: "my-cms" })
  .use(adminModule)
  .collections({
    posts: q.collection("posts")
      .fields({
        title: text("title").notNull(),
        slug: text("slug").notNull().unique(),
        content: text("content"),
        published: boolean("published").default(false),
        publishedAt: datetime("publishedAt"),
        viewCount: integer("viewCount").default(0),
      })
      .relations(({ one }) => ({
        author: one("users", {
          fields: ["authorId"],
          references: ["id"],
        }),
      }))
      .validation(({ z }) => ({
        title: z.string().min(1).max(200),
        slug: z.string().regex(/^[a-z0-9-]+$/),
      }))
      .hooks({
        beforeCreate: async ({ data }) => {
          if (!data.slug && data.title) {
            data.slug = slugify(data.title);
          }
          return data;
        },
      }),
  })
  .globals({
    settings: q.global("settings")
      .fields({
        siteName: text("siteName"),
        description: text("description"),
      }),
  })
  .auth({
    emailAndPassword: { enabled: true },
    secret: process.env.AUTH_SECRET,
  })
  .build({
    db: { url: process.env.DATABASE_URL },
  });

export type AppCMS = typeof cms;
```

## The `.build()` Method

Unlike the admin builder, the backend builder **requires** `.build()` to create runtime instances:

```typescript
const cms = q({ name: "my-cms" })
  .collections({...})
  .globals({...})
  .auth({...})
  .build({
    db: { url: process.env.DATABASE_URL },
    storage: { location: "./uploads" },
    email: { adapter: new SmtpAdapter({...}) },
    queue: { adapter: pgBossAdapter({...}) },
  });
```

After `.build()`, you have access to:

- `cms.api.collections.posts` - CRUD operations
- `cms.api.globals.settings` - Global operations
- `cms.collections.posts.table` - Drizzle table
- `cms.queue.myJob` - Job publishing
- `cms.auth` - Authentication client

## Documentation Sections

<Cards>
  <Card href="/docs/backend/collections" title="Collections" description="Define data models" />
  <Card href="/docs/backend/globals" title="Globals" description="Singleton documents" />
  <Card href="/docs/backend/fields" title="Fields" description="Field types and options" />
  <Card href="/docs/backend/relations" title="Relations" description="Link collections" />
  <Card href="/docs/backend/hooks" title="Hooks" description="Lifecycle events" />
  <Card href="/docs/backend/access-control" title="Access Control" description="Permissions" />
</Cards>

## API Access

### Server-Side

Access the API directly in server code:

```typescript
// Get all published posts
const { docs } = await cms.api.collections.posts.find({
  where: { published: true },
  orderBy: { publishedAt: "desc" },
  limit: 10,
});

// Create a post
const post = await cms.api.collections.posts.create({
  title: "Hello World",
  slug: "hello-world",
  content: "...",
});

// Update a post
await cms.api.collections.posts.update({
  where: { id: post.id },
  data: { published: true },
});
```

### Client-Side

Use the generated client:

```typescript
import { createClient } from "questpie/client";
import type { AppCMS } from "./cms";

const client = createClient<AppCMS>({
  baseUrl: "/api/cms",
});

// Type-safe API calls
const { docs } = await client.collections.posts.find({ limit: 10 });
```

## Modules

QUESTPIE uses modules to extend functionality:

```typescript
import { adminModule } from "@questpie/admin/server";

const cms = q({ name: "my-cms" })
  .use(adminModule)  // Adds users, assets, auth routes
  .collections({...})
  .build({...});
```

The `adminModule` provides:
- `users` collection
- `assets` collection (file uploads)
- Auth routes for Better Auth

## Related

- [Collections](/docs/backend/collections) - Define your data models
- [Builder API](/docs/backend/builder-api) - Complete q() reference
- [Authentication](/docs/guides/authentication) - Set up user auth
- [Adapters](/docs/adapters) - Connect to your framework
